import{t as C,a as h,c as ie,b as ce}from"../chunks/B9r7Lxv7.js";import{o as at,t as g,v as ve,w as A,x as st,y as e,z as n,A as q,B as _,$ as ot,C as d,D as Y,F as ut,G as fe}from"../chunks/DJO_Dd2D.js";import{d as it,h as ct,e as De,s as ee}from"../chunks/E0YcaHjI.js";import{i as F}from"../chunks/BC4-H-Hm.js";import{e as G,i as R}from"../chunks/BM5fpgaH.js";import{s as te}from"../chunks/C3OoYx-B.js";import{s as z}from"../chunks/BpivT8qo.js";import{b as vt}from"../chunks/Bl4hghnE.js";import{o as ft}from"../chunks/BdGLp4vx.js";function dt(M,T,v,I,X,b,f,p,m){if(e(T)===null)return;M.preventDefault(),n(v,M.clientX,!0),n(I,M.clientY,!0),n(X,!0);const w=b(e(v),e(I)-60);w?(n(f,w.row,!0),n(p,w.col,!0),n(m,e(T),!0)):(n(f,null),n(p,null))}function pt(M,T,v,I,X,b,f,p,m,w,D,y){if(e(T)===null)return;M.preventDefault();const x=e(T);if(e(v)){const B=I(e(X),e(b)-60);if(B&&e(f)[x]){const L=e(f)[x];p(L,B.row,B.col)&&m(x,B.row,B.col)}}else w(x);n(T,null),n(v,!1),n(D,null),n(y,null)}var ht=C('<div class="combo-text svelte-1lvq3nx"> </div>'),_t=C("<button></button>"),mt=C("<div></div>"),gt=C('<div class="piece-grid svelte-1lvq3nx"></div>'),xt=C("<button><!></button>"),bt=C("<div></div>"),qt=C('<div class="drag-ghost svelte-1lvq3nx"><div class="piece-grid svelte-1lvq3nx"></div></div>'),wt=C('<p class="new-best svelte-1lvq3nx">New Best!</p>'),yt=C('<div class="game-over-overlay svelte-1lvq3nx"><div class="game-over-card svelte-1lvq3nx"><h2 class="svelte-1lvq3nx">Game Over!</h2> <p class="final-score svelte-1lvq3nx"> </p> <!> <button class="restart-btn svelte-1lvq3nx">Play Again</button></div></div>'),Pt=C('<div class="game-container svelte-1lvq3nx"><div class="header svelte-1lvq3nx"><h1 class="svelte-1lvq3nx">Block Blast</h1> <div class="scores svelte-1lvq3nx"><div class="score-box svelte-1lvq3nx"><span class="score-label svelte-1lvq3nx">Score</span> <span class="score-value svelte-1lvq3nx"> </span></div> <div class="score-box high svelte-1lvq3nx"><span class="score-label svelte-1lvq3nx">Best</span> <span class="score-value svelte-1lvq3nx"> </span></div></div></div> <!> <div class="game-layout svelte-1lvq3nx"><div class="board svelte-1lvq3nx"></div> <div class="pieces-area svelte-1lvq3nx"><p class="pieces-label svelte-1lvq3nx"><!></p> <div class="pieces-row svelte-1lvq3nx"></div></div></div> <!> <!> <div class="back-link svelte-1lvq3nx"><a href="/" class="svelte-1lvq3nx">Back to Home</a></div></div>');function Mt(M,T){at(T,!0);const v=8,I=["#e74c3c","#e67e22","#2ecc71","#3498db","#9b59b6","#f1c40f","#1abc9c"],X=[[[!0]],[[!0,!0]],[[!0,!0,!0]],[[!0,!0,!0,!0]],[[!0,!0,!0,!0,!0]],[[!0],[!0]],[[!0],[!0],[!0]],[[!0],[!0],[!0],[!0]],[[!0],[!0],[!0],[!0],[!0]],[[!0,!0],[!0,!0]],[[!0,!0,!0],[!0,!0,!0],[!0,!0,!0]],[[!0,!1],[!0,!1],[!0,!0]],[[!1,!0],[!1,!0],[!0,!0]],[[!0,!0],[!0,!1],[!0,!1]],[[!0,!0],[!1,!0],[!1,!0]],[[!0,!0,!0],[!1,!0,!1]],[[!1,!0,!1],[!0,!0,!0]],[[!0,!1],[!0,!0],[!0,!1]],[[!1,!0],[!0,!0],[!1,!0]],[[!0,!0,!1],[!1,!0,!0]],[[!1,!0,!0],[!0,!0,!1]],[[!0,!1],[!0,!0],[!1,!0]],[[!1,!0],[!0,!0],[!0,!1]],[[!0,!0],[!0,!1]],[[!0,!0],[!1,!0]],[[!0,!1],[!0,!0]],[[!1,!0],[!0,!0]]];let b=g(ve(de())),f=g(ve([])),p=g(null),m=g(0),w=g(0),D=g(!1),y=g(null),x=g(null),B=g(ve(new Set)),L=g(""),re=null,P=g(null),J=g(0),K=g(0),S=g(!1),Q=g(void 0);function de(){return Array.from({length:v},()=>Array(v).fill(null))}function He(){return I[Math.floor(Math.random()*I.length)]}function le(){return{shape:X[Math.floor(Math.random()*X.length)],color:He()}}function pe(){n(f,[le(),le(),le()],!0),n(p,null)}function N(t,r,a){for(let l=0;l<t.shape.length;l++)for(let s=0;s<t.shape[l].length;s++)if(t.shape[l][s]){const i=r+l,o=a+s;if(i<0||i>=v||o<0||o>=v||e(b)[i][o]!==null)return!1}return!0}function Me(t){for(let r=0;r<v;r++)for(let a=0;a<v;a++)if(N(t,r,a))return!0;return!1}function he(){for(const t of e(f))if(t&&Me(t))return!0;return!1}function Ie(t,r,a){let l=0;const s=e(b).map(i=>[...i]);for(let i=0;i<t.shape.length;i++)for(let o=0;o<t.shape[i].length;o++)t.shape[i][o]&&(s[r+i][a+o]=t.color,l++);n(b,s,!0),n(m,e(m)+l),_e()}function _e(){const t=[],r=[];for(let o=0;o<v;o++)e(b)[o].every(u=>u!==null)&&t.push(o);for(let o=0;o<v;o++){let u=!0;for(let c=0;c<v;c++)if(e(b)[c][o]===null){u=!1;break}u&&r.push(o)}const a=t.length+r.length;if(a===0)return;const l=new Set;for(const o of t)for(let u=0;u<v;u++)l.add(`${o},${u}`);for(const o of r)for(let u=0;u<v;u++)l.add(`${u},${o}`);const s=a*v,i=a>1?a*10:0;n(m,e(m)+(s+i)),a>1?me(`${a}x Combo! +${s+i}`):me(`Line clear! +${s}`),n(B,l,!0),setTimeout(()=>{const o=e(b).map(u=>[...u]);for(const u of l){const[c,k]=u.split(",").map(Number);o[c][k]=null}n(b,o,!0),n(B,new Set,!0),_e()},300)}function me(t){n(L,t,!0),re&&clearTimeout(re),re=setTimeout(()=>{n(L,"")},1500)}function Le(t){e(D)||e(f)[t]!==null&&n(p,e(p)===t?null:t,!0)}function ge(t,r,a){const l=e(f)[t];if(!l||!N(l,r,a))return;Ie(l,r,a);const s=[...e(f)];s[t]=null,n(f,s,!0),n(p,null),e(f).every(i=>i===null)?setTimeout(()=>{pe(),he()||be()},350):he()||setTimeout(()=>be(),350)}function Oe(t,r){e(D)||e(p)===null||ge(e(p),t,r)}function Ee(t,r){n(y,t,!0),n(x,r,!0)}function Fe(){n(y,null),n(x,null)}function xe(t,r){if(!e(Q))return null;const a=e(Q).getBoundingClientRect(),l=6,s=t-a.left-l,i=r-a.top-l,o=(a.width-l*2)/v,u=Math.floor(s/o),c=Math.floor(i/o);return c<0||c>=v||u<0||u>=v?null:{row:c,col:u}}function Ge(t,r){e(D)||e(f)[r]===null||(t.preventDefault(),t.target.setPointerCapture(t.pointerId),n(P,r,!0),n(J,t.clientX,!0),n(K,t.clientY,!0),n(S,!1))}function Re(){return e(P)===null||!e(S)?null:e(f)[e(P)]??null}function Xe(){const t=e(S)?e(P):e(p);if(t===null||e(y)===null||e(x)===null)return new Set;const r=e(f)[t];if(!r)return new Set;if(!N(r,e(y),e(x)))return new Set;const a=new Set;for(let l=0;l<r.shape.length;l++)for(let s=0;s<r.shape[l].length;s++)r.shape[l][s]&&a.add(`${e(y)+l},${e(x)+s}`);return a}function Ye(){const t=e(S)?e(P):e(p);if(t===null||e(y)===null||e(x)===null)return!1;const r=e(f)[t];return r?!N(r,e(y),e(x)):!1}function be(){n(D,!0),e(m)>e(w)&&(n(w,e(m),!0),ze())}function qe(){n(b,de(),!0),n(m,0),n(D,!1),n(B,new Set,!0),n(L,""),n(P,null),n(S,!1),pe()}function ze(){try{localStorage.setItem("block-blast-high-score",String(e(w)))}catch{}}function Ne(){try{const t=localStorage.getItem("block-blast-high-score");t&&n(w,parseInt(t,10)||0,!0)}catch{}}let Ue=Y(Xe),Ze=Y(Ye),V=Y(Re);ft(()=>{Ne(),qe()});function je(){const t=e(S)?e(P):e(p);if(t===null)return"";const r=e(f)[t];return r?r.color:""}var U=Pt();ct(t=>{ot.title="Block Blast"}),U.__pointermove=[dt,P,J,K,S,xe,y,x,p],U.__pointerup=[pt,P,S,xe,J,K,f,N,ge,Le,y,x];var ne=_(U),we=q(_(ne),2),ae=_(we),ye=q(_(ae),2),Je=_(ye,!0);d(ye),d(ae);var Pe=q(ae,2),Se=q(_(Pe),2),Ke=_(Se,!0);d(Se),d(Pe),d(we),d(ne);var ke=q(ne,2);{var Qe=t=>{var r=ht(),a=_(r,!0);d(r),A(()=>ee(a,e(L))),h(t,r)};F(ke,t=>{e(L)&&t(Qe)})}var se=q(ke,2),Z=_(se);G(Z,21,()=>e(b),R,(t,r,a)=>{var l=ie(),s=fe(l);G(s,17,()=>e(r),R,(i,o,u)=>{var c=_t();const k=Y(()=>`${a},${u}`),O=Y(()=>e(B).has(e(k))),$=Y(()=>e(Ue).has(e(k)));let H;c.__click=()=>Oe(a,u);let E;A((j,W)=>{H=te(c,1,"cell svelte-1lvq3nx",null,H,j),E=z(c,"",E,{"background-color":W,opacity:e($)&&!e(o)?"0.5":"1"})},[()=>({filled:e(o)!==null,clearing:e(O),"hover-preview":e($),"invalid-hover":e(Ze)&&(e(p)!==null||e(P)!==null)&&e(y)!==null}),()=>e(O)?"#fff":e($)?je():e(o)||""]),De("mouseenter",c,()=>Ee(a,u)),h(i,c)}),h(t,l)}),d(Z),vt(Z,t=>n(Q,t),()=>e(Q));var Be=q(Z,2),oe=_(Be),Ve=_(oe);{var We=t=>{var r=ce("Drag onto the board");h(t,r)},et=(t,r)=>{{var a=s=>{var i=ce("Tap the board to place");h(s,i)},l=s=>{var i=ce("Drag or tap a piece");h(s,i)};F(t,s=>{e(p)!==null?s(a):s(l,!1)},r)}};F(Ve,t=>{e(S)?t(We):t(et,!1)})}d(oe);var Ce=q(oe,2);G(Ce,21,()=>e(f),R,(t,r,a)=>{var l=xt();let s;l.__pointerdown=u=>Ge(u,a);var i=_(l);{var o=u=>{var c=gt();let k;G(c,21,()=>e(r).shape,R,(O,$)=>{var H=ie(),E=fe(H);G(E,17,()=>e($),R,(j,W)=>{var ue=mt();let Ae,Te;A(nt=>{Ae=te(ue,1,"piece-cell svelte-1lvq3nx",null,Ae,nt),Te=z(ue,"",Te,{"background-color":e(W)?e(r).color:"transparent"})},[()=>({"piece-filled":e(W)})]),h(j,ue)}),h(O,H)}),d(c),A(()=>k=z(c,"",k,{"grid-template-columns":`repeat(${e(r).shape[0].length}, 1fr)`})),h(u,c)};F(i,u=>{e(r)&&u(o)})}d(l),A(u=>{s=te(l,1,"piece-container svelte-1lvq3nx",null,s,u),l.disabled=e(r)===null},[()=>({selected:e(p)===a&&!e(S),dragging:e(P)===a&&e(S),used:e(r)===null})]),h(t,l)}),d(Ce),d(Be),d(se);var $e=q(se,2);{var tt=t=>{var r=qt();let a;var l=_(r);let s;G(l,21,()=>e(V).shape,R,(i,o)=>{var u=ie(),c=fe(u);G(c,17,()=>e(o),R,(k,O)=>{var $=bt();let H,E;A(j=>{H=te($,1,"piece-cell drag-cell svelte-1lvq3nx",null,H,j),E=z($,"",E,{"background-color":e(O)?e(V).color:"transparent"})},[()=>({"piece-filled":e(O)})]),h(k,$)}),h(i,u)}),d(l),d(r),A(()=>{a=z(r,"",a,{left:`${e(J)??""}px`,top:`${e(K)-60}px`}),s=z(l,"",s,{"grid-template-columns":`repeat(${e(V).shape[0].length}, 1fr)`})}),h(t,r)};F($e,t=>{e(V)&&t(tt)})}var rt=q($e,2);{var lt=t=>{var r=yt(),a=_(r),l=q(_(a),2),s=_(l);d(l);var i=q(l,2);{var o=c=>{var k=wt();h(c,k)};F(i,c=>{e(m)>=e(w)&&e(m)>0&&c(o)})}var u=q(i,2);u.__click=qe,d(a),d(r),A(()=>ee(s,`Score: ${e(m)??""}`)),h(t,r)};F(rt,t=>{e(D)&&t(lt)})}ut(2),d(U),A(()=>{ee(Je,e(m)),ee(Ke,e(w))}),De("mouseleave",Z,Fe),h(M,U),st()}it(["pointermove","pointerup","click","pointerdown"]);export{Mt as component};
