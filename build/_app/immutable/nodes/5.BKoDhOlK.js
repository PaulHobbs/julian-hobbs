import{t as st,a as j,b as J}from"../chunks/Dqht5w_I.js";import{o as Kt,t as q,v as Qt,I as Vt,B as m,A as M,z as c,w as at,x as Zt,y as e,J as te,$ as ee,C as b,D as ne,F as oe}from"../chunks/p36N7C4D.js";import{d as ae,h as se,s as F}from"../chunks/DZw39atF.js";import{i as X}from"../chunks/BFlFReWa.js";import{e as ie,s as le,i as re}from"../chunks/Cifj1Jul.js";import{s as Ct}from"../chunks/vYU-8VYL.js";import{s as jt}from"../chunks/eLZ9zutM.js";import{b as Rt}from"../chunks/CJ2niMAg.js";import{o as ce}from"../chunks/3WYckkoF.js";function de(R,_,w){e(_)&&w(R)}function he(R,_,w,Y){e(_)!==null&&(c(w,e(w).filter(it=>it.id!==e(_)),!0),c(_,null),Y())}function fe(R,_,w,Y){c(_,[],!0),c(w,null),c(Y,1)}function ve(R,_){c(_,!e(_))}var pe=(R,_)=>c(_,!e(_)),ue=(R,_,w)=>_(R,e(w)),be=st('<button class="palette-item svelte-1q7bn03"><div class="palette-preview svelte-1q7bn03"><!></div> <span class="palette-label svelte-1q7bn03"> </span></button>'),me=st('<div class="info-row svelte-1q7bn03"><span class="info-label svelte-1q7bn03">Ratio:</span> <span class="info-value svelte-1q7bn03"> </span></div>'),_e=st('<div class="info-panel svelte-1q7bn03"><div class="info-title svelte-1q7bn03"> </div> <div class="info-row svelte-1q7bn03"><span class="info-label svelte-1q7bn03">Teeth:</span> <span class="info-value svelte-1q7bn03"> </span></div> <div class="info-row svelte-1q7bn03"><span class="info-label svelte-1q7bn03">RPM:</span> <span class="info-value svelte-1q7bn03"> </span></div> <div class="info-row svelte-1q7bn03"><span class="info-label svelte-1q7bn03">Direction:</span> <span class="info-value svelte-1q7bn03"><!></span></div> <!></div>'),ye=st('<div><div class="header svelte-1q7bn03"><h1 class="svelte-1q7bn03">Gear Train Simulator</h1> <div class="controls svelte-1q7bn03"><button class="ctrl-btn svelte-1q7bn03"> </button> <button class="ctrl-btn svelte-1q7bn03" title="Delete selected">üóëÔ∏è</button> <button class="ctrl-btn svelte-1q7bn03" title="Clear all">Clear</button> <button class="ctrl-btn svelte-1q7bn03"> </button></div></div> <div class="palette svelte-1q7bn03"></div> <div class="canvas-container svelte-1q7bn03"><canvas class="svelte-1q7bn03"></canvas></div> <!> <div class="instructions svelte-1q7bn03">Drag components from the palette onto the canvas. Gears snap together automatically!</div> <div class="back-link svelte-1q7bn03"><a href="/" class="svelte-1q7bn03">Back to Home</a></div></div>');function Ie(R,_){Kt(_,!0);const w=5,Y=60,it=15,xt=[{type:"motor",teeth:12,label:"Motor",color:"#e74c3c"},{type:"sheep",teeth:12,label:"Sheep",color:"#f5f0e1"},{type:"gear",teeth:12,label:"12T",color:"#2ecc71"},{type:"gear",teeth:20,label:"20T",color:"#3498db"},{type:"gear",teeth:32,label:"32T",color:"#e67e22"},{type:"gear",teeth:38,label:"38T",color:"#1abc9c"},{type:"gear",teeth:48,label:"48T",color:"#9b59b6"}];function P(t){return t*w/2}let g=q(void 0),d=q(Qt([])),_t=q(1),E=q(null),H=q(!0),x=q(!0),lt=0,V=0,G=q(!1),p=q(null),y=q(null),N=0,U=0,A=q(0),L=q(0),Z=q(void 0),S=q(800),I=q(500),T=ne(()=>e(d).find(t=>t.id===e(E))??null);function At(t,n){return P(t.teeth)+P(n.teeth)}function Lt(t,n){const s=t.x-n.x,o=t.y-n.y;return Math.sqrt(s*s+o*o)}function yt(t,n){const s=At(t,n),o=Lt(t,n);return Math.abs(o-s)<3}function rt(t,n,s,o){let a=null,i=1/0;for(const r of e(d)){if(r.id===o)continue;const v=P(t.teeth)+P(r.teeth),l=n-r.x,h=s-r.y,f=Math.sqrt(l*l+h*h);if(Math.abs(f-v)<it+v*.3){const u=P(t.teeth)+P(r.teeth);if(f<u*.5)continue;const k=Math.abs(f-v);if(k<i){i=k;const C=Math.atan2(h,l);a={x:r.x+Math.cos(C)*v,y:r.y+Math.sin(C)*v,snapTo:r}}}}return a}function Mt(t,n,s,o){const a=P(t);for(const i of e(d)){if(i.id===o)continue;const r=P(i.teeth),v=n-i.x,l=s-i.y,h=Math.sqrt(v*v+l*l),f=(a+r)*.8,u=a+r;if(h<f&&Math.abs(h-u)>3)return!0}return!1}function ct(){for(const a of e(d))a.rpm=0,a.direction=0,a.jammed=!1;const t=new Map;for(const a of e(d))t.set(a.id,[]);for(let a=0;a<e(d).length;a++)for(let i=a+1;i<e(d).length;i++)yt(e(d)[a],e(d)[i])&&(t.get(e(d)[a].id).push(e(d)[i].id),t.get(e(d)[i].id).push(e(d)[a].id));const n=e(d).filter(a=>a.type==="motor"||a.type==="sheep"),s=new Set,o=new Map;for(const a of e(d))o.set(a.id,a);for(const a of n){if(s.has(a.id))continue;a.rpm=Y,a.direction=1;const i=[a.id];for(s.add(a.id);i.length>0;){const r=i.shift(),v=o.get(r);for(const l of t.get(r)){const h=o.get(l),f=-v.direction,u=v.rpm*v.teeth/h.teeth;if(s.has(l)){h.direction!==f&&Et(a.id,t,o);continue}h.direction=f,h.rpm=u,s.add(l),i.push(l)}}}}function Et(t,n,s){const o=new Set,a=[t];for(o.add(t);a.length>0;){const i=a.shift(),r=s.get(i);r.jammed=!0,r.rpm=0,r.direction=0;for(const v of n.get(i))o.has(v)||(o.add(v),a.push(v))}}function gt(t,n,s){const o=P(n.teeth),a=o+w*.8,i=o-w*.8,r=n.teeth;if(t.save(),t.translate(n.x,n.y),t.rotate(n.angle),Math.abs(n.rpm)>100&&!n.jammed){const l=Math.min((Math.abs(n.rpm)-100)/200,1);t.shadowColor=n.color,t.shadowBlur=15+l*20}t.beginPath();for(let l=0;l<r;l++){const h=l/r*Math.PI*2,f=(l+.15)/r*Math.PI*2,u=(l+.35)/r*Math.PI*2,k=(l+.5)/r*Math.PI*2,C=(l+.65)/r*Math.PI*2,O=(l+.85)/r*Math.PI*2;l===0&&t.moveTo(Math.cos(h)*i,Math.sin(h)*i),t.lineTo(Math.cos(f)*i,Math.sin(f)*i),t.lineTo(Math.cos(u)*a,Math.sin(u)*a),t.lineTo(Math.cos(k)*a,Math.sin(k)*a),t.lineTo(Math.cos(C)*a,Math.sin(C)*a),t.lineTo(Math.cos(O)*i,Math.sin(O)*i);const nt=(l+1)/r*Math.PI*2;t.lineTo(Math.cos(nt)*i,Math.sin(nt)*i)}t.closePath();const v=n.jammed?"#555":n.color;if(t.fillStyle=v,t.fill(),t.strokeStyle=n.jammed?"#333":dt(n.color,.3),t.lineWidth=2,t.stroke(),t.shadowBlur=0,t.beginPath(),t.arc(0,0,Math.max(o*.25,8),0,Math.PI*2),t.fillStyle=n.jammed?"#444":dt(n.color,.2),t.fill(),t.strokeStyle=n.jammed?"#333":dt(n.color,.4),t.lineWidth=2,t.stroke(),t.beginPath(),t.arc(0,0,Math.max(o*.08,3),0,Math.PI*2),t.fillStyle=e(x)?"#1a1a3e":"#ccc",t.fill(),n.type==="motor"&&!n.jammed&&(t.fillStyle="#fff",t.font=`bold ${Math.max(o*.35,10)}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("‚ö°",0,0)),n.type==="sheep"&&!n.jammed&&(t.fillStyle="#333",t.font=`${Math.max(o*.5,12)}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("üêë",0,1)),t.restore(),s&&(t.save(),t.translate(n.x,n.y),t.beginPath(),t.arc(0,0,a+6,0,Math.PI*2),t.strokeStyle="#f1c40f",t.lineWidth=3,t.setLineDash([6,4]),t.stroke(),t.setLineDash([]),t.restore()),n.direction!==0&&!n.jammed&&e(H)){t.save(),t.translate(n.x,n.y);const l=a+12,h=n.angle+(n.direction>0?0:Math.PI);t.beginPath(),t.arc(0,0,l,h-.3,h+.3),t.strokeStyle=e(x)?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.3)",t.lineWidth=2,t.stroke();const f=Math.cos(h+.3*n.direction)*l,u=Math.sin(h+.3*n.direction)*l;t.beginPath(),t.moveTo(f,u);const k=h+.3*n.direction+Math.PI/2*n.direction;t.lineTo(f+Math.cos(k)*6,u+Math.sin(k)*6),t.lineTo(f+Math.cos(h+.3*n.direction)*8,u+Math.sin(h+.3*n.direction)*8),t.fillStyle=e(x)?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.3)",t.fill(),t.restore()}}function dt(t,n){const s=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return`rgb(${Math.round(s*(1-n))}, ${Math.round(o*(1-n))}, ${Math.round(a*(1-n))})`}function Gt(){if(!e(g))return;const t=e(g).getContext("2d");if(!t)return;const n=window.devicePixelRatio||1;t.setTransform(n,0,0,n,0,0),t.clearRect(0,0,e(S),e(I)),t.strokeStyle=e(x)?"rgba(255,255,255,0.04)":"rgba(0,0,0,0.06)",t.lineWidth=1;const s=40;for(let o=0;o<e(S);o+=s)t.beginPath(),t.moveTo(o,0),t.lineTo(o,e(I)),t.stroke();for(let o=0;o<e(I);o+=s)t.beginPath(),t.moveTo(0,o),t.lineTo(e(S),o),t.stroke();for(let o=0;o<e(d).length;o++)for(let a=o+1;a<e(d).length;a++)yt(e(d)[o],e(d)[a])&&(t.beginPath(),t.moveTo(e(d)[o].x,e(d)[o].y),t.lineTo(e(d)[a].x,e(d)[a].y),t.strokeStyle=e(d)[o].jammed?"rgba(255,0,0,0.3)":e(x)?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.12)",t.lineWidth=2,t.setLineDash([4,4]),t.stroke(),t.setLineDash([]));for(const o of e(d))gt(t,o,o.id===e(E));if(e(G)&&(e(p)||e(y))){const o=e(p)?e(p).teeth:e(y).teeth,a=e(p)?e(p).color:e(y).color,i=e(p)?e(p).type:e(y).type,r=e(p)?e(p).id:-1;let v=e(A),l=e(L);const h=rt({teeth:o},v,l,r);h&&(v=h.x,l=h.y);const f={type:i,teeth:o,x:v,y:l,angle:0,rpm:0,direction:0,color:a,jammed:!1};t.globalAlpha=.5,gt(t,f,!1),t.globalAlpha=1,h&&(t.beginPath(),t.arc(v,l,P(o)+w+4,0,Math.PI*2),t.strokeStyle="#f1c40f",t.lineWidth=2,t.setLineDash([4,4]),t.stroke(),t.setLineDash([]))}}function wt(t){V||(V=t);const n=(t-V)/1e3;if(V=t,e(H)){for(const s of e(d))if(s.direction!==0&&!s.jammed){const o=s.rpm/60;s.angle+=s.direction*o*Math.PI*2*n}}Gt(),lt=requestAnimationFrame(wt)}function Pt(t){if(!e(g))return{x:0,y:0};const n=e(g).getBoundingClientRect();return{x:(t.clientX-n.left)*(e(S)/n.width),y:(t.clientY-n.top)*(e(I)/n.height)}}function Bt(t,n){for(let s=e(d).length-1;s>=0;s--){const o=e(d)[s],a=P(o.teeth)+w,i=t-o.x,r=n-o.y;if(i*i+r*r<=a*a)return o}return null}function Wt(t){var o;const n=Pt(t),s=Bt(n.x,n.y);s?(t.preventDefault(),(o=e(g))==null||o.setPointerCapture(t.pointerId),c(G,!0),c(p,s,!0),c(y,null),N=n.x-s.x,U=n.y-s.y,c(A,n.x-N),c(L,n.y-U),c(E,s.id,!0)):c(E,null)}function Ft(t){if(!e(G))return;t.preventDefault();const n=Pt(t);e(p)?(c(A,n.x-N),c(L,n.y-U)):e(y)&&(c(A,n.x,!0),c(L,n.y,!0))}function qt(t){if(e(G)){if(t.preventDefault(),e(p)){let n=e(A),s=e(L);const o=rt({teeth:e(p).teeth},n,s,e(p).id);o&&(n=o.x,s=o.y),Mt(e(p).teeth,n,s,e(p).id)||(e(p).x=n,e(p).y=s),ct()}else if(e(y)){let n=e(A),s=e(L);const o=rt({teeth:e(y).teeth},n,s,-1);o&&(n=o.x,s=o.y);const a=P(e(y).teeth);if(n>a&&n<e(S)-a&&s>a&&s<e(I)-a&&!Mt(e(y).teeth,n,s,-1)){const i={id:te(_t),type:e(y).type,teeth:e(y).teeth,x:n,y:s,angle:0,rpm:0,direction:0,color:e(y).color,jammed:!1,label:e(y).label};c(d,[...e(d),i],!0),c(E,i.id,!0),ct()}}c(G,!1),c(p,null),c(y,null)}}function Xt(t,n){if(t.preventDefault(),c(G,!0),c(y,n,!0),c(p,null),e(g)){const s=e(g).getBoundingClientRect();c(A,(t.clientX-s.left)*(e(S)/s.width)),c(L,(t.clientY-s.top)*(e(I)/s.height))}N=0,U=0}function Yt(t){if(e(G)&&(t.preventDefault(),e(g))){const n=e(g).getBoundingClientRect(),s=(t.clientX-n.left)*(e(S)/n.width),o=(t.clientY-n.top)*(e(I)/n.height);e(p)?(c(A,s-N),c(L,o-U)):(c(A,s),c(L,o))}}function Tt(){if(!e(Z))return;const t=e(Z).getBoundingClientRect();c(S,t.width,!0),c(I,Math.max(t.height,300),!0)}function ht(){if(!e(g))return;const t=window.devicePixelRatio||1;e(g).width=e(S)*t,e(g).height=e(I)*t}Vt(()=>{e(g)&&e(S)&&e(I)&&ht()}),ce(()=>{Tt(),ht(),lt=requestAnimationFrame(wt);const t=()=>{Tt(),ht()};return window.addEventListener("resize",t),()=>{cancelAnimationFrame(lt),window.removeEventListener("resize",t)}});var $=ye();se(t=>{ee.title="Gear Train Simulator"});let kt;$.__pointermove=Yt,$.__pointerup=[de,G,qt];var ft=m($),Dt=M(m(ft),2),K=m(Dt);K.__click=[ve,H];var $t=m(K,!0);b(K);var vt=M(K,2);vt.__click=[he,E,d,ct];var St=M(vt,2);St.__click=[fe,d,E,_t];var tt=M(St,2);tt.__click=[pe,x];var Ot=m(tt,!0);b(tt),b(Dt),b(ft);var pt=M(ft,2);ie(pt,21,()=>xt,re,(t,n)=>{var s=be();s.__pointerdown=[ue,Xt,n];var o=m(s);let a;var i=m(o);{var r=f=>{var u=J("‚ö°");j(f,u)},v=(f,u)=>{{var k=C=>{var O=J("üêë");j(C,O)};X(f,C=>{e(n).type==="sheep"&&C(k)},u)}};X(i,f=>{e(n).type==="motor"?f(r):f(v,!1)})}b(o);var l=M(o,2),h=m(l,!0);b(l),b(s),at((f,u)=>{a=jt(o,"",a,{"background-color":e(n).color,width:`${f??""}px`,height:`${u??""}px`}),F(h,e(n).label)},[()=>Math.max(P(e(n).teeth)*.8,16),()=>Math.max(P(e(n).teeth)*.8,16)]),j(t,s)}),b(pt);var et=M(pt,2),Q=m(et);Q.__pointerdown=Wt,Q.__pointermove=Ft,Q.__pointerup=qt;let It;Rt(Q,t=>c(g,t),()=>e(g)),b(et),Rt(et,t=>c(Z,t),()=>e(Z));var zt=M(et,2);{var Jt=t=>{var n=_e(),s=m(n),o=m(s,!0);b(s);var a=M(s,2),i=M(m(a),2),r=m(i,!0);b(i),b(a);var v=M(a,2),l=M(m(v),2),h=m(l,!0);b(l),b(v);var f=M(v,2),u=M(m(f),2),k=m(u);{var C=D=>{var W=J("Jammed");j(D,W)},O=(D,W)=>{{var ot=B=>{var bt=J("Clockwise ‚Üª");j(B,bt)},ut=(B,bt)=>{{var Nt=z=>{var mt=J("Counter-CW ‚Ü∫");j(z,mt)},Ut=z=>{var mt=J("Idle");j(z,mt)};X(B,z=>{e(T).direction===-1?z(Nt):z(Ut,!1)},bt)}};X(D,B=>{e(T).direction===1?B(ot):B(ut,!1)},W)}};X(k,D=>{e(T).jammed?D(C):D(O,!1)})}b(u),b(f);var nt=M(f,2);{var Ht=D=>{var W=me(),ot=M(m(W),2),ut=m(ot);b(ot),b(W),at(B=>F(ut,`${B??""}x`),[()=>(e(T).rpm/Y).toFixed(2)]),j(D,W)};X(nt,D=>{e(T).type==="gear"&&e(T).rpm>0&&D(Ht)})}b(n),at(D=>{F(o,e(T).type==="motor"?"Motor":e(T).type==="sheep"?"Sheep Motor üêë":`Gear (${e(T).teeth}T)`),F(r,e(T).teeth),F(h,D)},[()=>e(T).jammed?"JAMMED":Math.abs(e(T).rpm).toFixed(1)]),j(t,n)};X(zt,t=>{e(T)&&t(Jt)})}oe(4),b($),at(t=>{kt=le($,1,"page-container svelte-1q7bn03",null,kt,t),Ct(K,"title",e(H)?"Pause":"Play"),F($t,e(H)?"‚è∏":"‚ñ∂Ô∏è"),vt.disabled=e(E)===null,Ct(tt,"title",e(x)?"Light mode":"Dark mode"),F(Ot,e(x)?"‚òÄÔ∏è":"üåô"),It=jt(Q,"",It,{width:`${e(S)??""}px`,height:`${e(I)??""}px`})},[()=>({light:!e(x)})]),j(R,$),Zt()}ae(["pointermove","pointerup","click","pointerdown"]);export{Ie as component};
