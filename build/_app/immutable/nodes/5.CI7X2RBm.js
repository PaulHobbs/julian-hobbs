import{t as ot,a as R,b as U}from"../chunks/B9r7Lxv7.js";import{o as zt,t as j,v as Jt,I as Ht,B as m,A as y,w as nt,x as Nt,y as e,z as d,J as Ut,$ as Kt,C as p,D as Qt,F as Vt}from"../chunks/DJO_Dd2D.js";import{d as Zt,h as te,s as F}from"../chunks/E0YcaHjI.js";import{i as X}from"../chunks/BC4-H-Hm.js";import{e as ee,i as ne}from"../chunks/BM5fpgaH.js";import{s as oe}from"../chunks/C7FEVJNA.js";import{s as qt}from"../chunks/BpivT8qo.js";import{b as Tt}from"../chunks/Bl4hghnE.js";import{o as ie}from"../chunks/BdGLp4vx.js";function ae(A,g,k){e(g)&&k(A)}function se(A,g,k,W){e(g)!==null&&(d(k,e(k).filter(it=>it.id!==e(g)),!0),d(g,null),W())}function re(A,g,k,W){d(g,[],!0),d(k,null),d(W,1)}function le(A,g){d(g,!e(g))}var ce=(A,g,k)=>g(A,e(k)),de=ot('<button class="palette-item svelte-1i2qrkj"><div class="palette-preview svelte-1i2qrkj"><!></div> <span class="palette-label svelte-1i2qrkj"> </span></button>'),fe=ot('<div class="info-row svelte-1i2qrkj"><span class="info-label svelte-1i2qrkj">Ratio:</span> <span class="info-value svelte-1i2qrkj"> </span></div>'),he=ot('<div class="info-panel svelte-1i2qrkj"><div class="info-title svelte-1i2qrkj"> </div> <div class="info-row svelte-1i2qrkj"><span class="info-label svelte-1i2qrkj">Teeth:</span> <span class="info-value svelte-1i2qrkj"> </span></div> <div class="info-row svelte-1i2qrkj"><span class="info-label svelte-1i2qrkj">RPM:</span> <span class="info-value svelte-1i2qrkj"> </span></div> <div class="info-row svelte-1i2qrkj"><span class="info-label svelte-1i2qrkj">Direction:</span> <span class="info-value svelte-1i2qrkj"><!></span></div> <!></div>'),ve=ot('<div class="page-container svelte-1i2qrkj"><div class="header svelte-1i2qrkj"><h1 class="svelte-1i2qrkj">Gear Train Simulator</h1> <div class="controls svelte-1i2qrkj"><button class="ctrl-btn svelte-1i2qrkj"> </button> <button class="ctrl-btn svelte-1i2qrkj" title="Delete selected">üóëÔ∏è</button> <button class="ctrl-btn svelte-1i2qrkj" title="Clear all">Clear</button></div></div> <div class="palette svelte-1i2qrkj"></div> <div class="canvas-container svelte-1i2qrkj"><canvas class="svelte-1i2qrkj"></canvas></div> <!> <div class="instructions svelte-1i2qrkj">Drag components from the palette onto the canvas. Gears snap together automatically!</div> <div class="back-link svelte-1i2qrkj"><a href="/" class="svelte-1i2qrkj">Back to Home</a></div></div>');function we(A,g){zt(g,!0);const k=5,W=60,it=15,Dt=[{type:"motor",teeth:12,label:"Motor",color:"#e74c3c"},{type:"gear",teeth:12,label:"12T",color:"#2ecc71"},{type:"gear",teeth:20,label:"20T",color:"#3498db"},{type:"gear",teeth:32,label:"32T",color:"#e67e22"},{type:"gear",teeth:48,label:"48T",color:"#9b59b6"}];function w(t){return t*k/2}let M=j(void 0),f=j(Jt([])),mt=j(1),x=j(null),Y=j(!0),at=0,K=0,L=j(!1),u=j(null),b=j(null),O=0,z=0,S=j(0),C=j(0),Q=j(void 0),T=j(800),D=j(500),P=Qt(()=>e(f).find(t=>t.id===e(x))??null);function It(t,n){return w(t.teeth)+w(n.teeth)}function St(t,n){const a=t.x-n.x,o=t.y-n.y;return Math.sqrt(a*a+o*o)}function bt(t,n){const a=It(t,n),o=St(t,n);return Math.abs(o-a)<3}function st(t,n,a,o){let i=null,s=1/0;for(const l of e(f)){if(l.id===o)continue;const h=w(t.teeth)+w(l.teeth),r=n-l.x,c=a-l.y,v=Math.sqrt(r*r+c*c);if(Math.abs(v-h)<it+h*.3){const _=w(t.teeth)+w(l.teeth);if(v<_*.5)continue;const I=Math.abs(v-h);if(I<s){s=I;const G=Math.atan2(c,r);i={x:l.x+Math.cos(G)*h,y:l.y+Math.sin(G)*h,snapTo:l}}}}return i}function Mt(t,n,a,o){const i=w(t);for(const s of e(f)){if(s.id===o)continue;const l=w(s.teeth),h=n-s.x,r=a-s.y,c=Math.sqrt(h*h+r*r),v=(i+l)*.8,_=i+l;if(c<v&&Math.abs(c-_)>3)return!0}return!1}function rt(){for(const i of e(f))i.rpm=0,i.direction=0,i.jammed=!1;const t=new Map;for(const i of e(f))t.set(i.id,[]);for(let i=0;i<e(f).length;i++)for(let s=i+1;s<e(f).length;s++)bt(e(f)[i],e(f)[s])&&(t.get(e(f)[i].id).push(e(f)[s].id),t.get(e(f)[s].id).push(e(f)[i].id));const n=e(f).filter(i=>i.type==="motor"),a=new Set,o=new Map;for(const i of e(f))o.set(i.id,i);for(const i of n){if(a.has(i.id))continue;i.rpm=W,i.direction=1;const s=[i.id];for(a.add(i.id);s.length>0;){const l=s.shift(),h=o.get(l);for(const r of t.get(l)){const c=o.get(r),v=-h.direction,_=h.rpm*h.teeth/c.teeth;if(a.has(r)){c.direction!==v&&Ct(i.id,t,o);continue}c.direction=v,c.rpm=_,a.add(r),s.push(r)}}}}function Ct(t,n,a){const o=new Set,i=[t];for(o.add(t);i.length>0;){const s=i.shift(),l=a.get(s);l.jammed=!0,l.rpm=0,l.direction=0;for(const h of n.get(s))o.has(h)||(o.add(h),i.push(h))}}function _t(t,n,a){const o=w(n.teeth),i=o+k*.8,s=o-k*.8,l=n.teeth;if(t.save(),t.translate(n.x,n.y),t.rotate(n.angle),Math.abs(n.rpm)>100&&!n.jammed){const r=Math.min((Math.abs(n.rpm)-100)/200,1);t.shadowColor=n.color,t.shadowBlur=15+r*20}t.beginPath();for(let r=0;r<l;r++){const c=r/l*Math.PI*2,v=(r+.15)/l*Math.PI*2,_=(r+.35)/l*Math.PI*2,I=(r+.5)/l*Math.PI*2,G=(r+.65)/l*Math.PI*2,Z=(r+.85)/l*Math.PI*2;r===0&&t.moveTo(Math.cos(c)*s,Math.sin(c)*s),t.lineTo(Math.cos(v)*s,Math.sin(v)*s),t.lineTo(Math.cos(_)*i,Math.sin(_)*i),t.lineTo(Math.cos(I)*i,Math.sin(I)*i),t.lineTo(Math.cos(G)*i,Math.sin(G)*i),t.lineTo(Math.cos(Z)*s,Math.sin(Z)*s);const tt=(r+1)/l*Math.PI*2;t.lineTo(Math.cos(tt)*s,Math.sin(tt)*s)}t.closePath();const h=n.jammed?"#555":n.color;if(t.fillStyle=h,t.fill(),t.strokeStyle=n.jammed?"#333":lt(n.color,.3),t.lineWidth=2,t.stroke(),t.shadowBlur=0,t.beginPath(),t.arc(0,0,Math.max(o*.25,8),0,Math.PI*2),t.fillStyle=n.jammed?"#444":lt(n.color,.2),t.fill(),t.strokeStyle=n.jammed?"#333":lt(n.color,.4),t.lineWidth=2,t.stroke(),t.beginPath(),t.arc(0,0,Math.max(o*.08,3),0,Math.PI*2),t.fillStyle="#1a1a3e",t.fill(),n.type==="motor"&&!n.jammed&&(t.beginPath(),t.fillStyle="#fff",t.font=`bold ${Math.max(o*.35,10)}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("‚ö°",0,0)),t.restore(),a&&(t.save(),t.translate(n.x,n.y),t.beginPath(),t.arc(0,0,i+6,0,Math.PI*2),t.strokeStyle="#f1c40f",t.lineWidth=3,t.setLineDash([6,4]),t.stroke(),t.setLineDash([]),t.restore()),n.direction!==0&&!n.jammed&&e(Y)){t.save(),t.translate(n.x,n.y);const r=i+12,c=n.angle+(n.direction>0?0:Math.PI);t.beginPath(),t.arc(0,0,r,c-.3,c+.3),t.strokeStyle="rgba(255,255,255,0.4)",t.lineWidth=2,t.stroke();const v=Math.cos(c+.3*n.direction)*r,_=Math.sin(c+.3*n.direction)*r;t.beginPath(),t.moveTo(v,_);const I=c+.3*n.direction+Math.PI/2*n.direction;t.lineTo(v+Math.cos(I)*6,_+Math.sin(I)*6),t.lineTo(v+Math.cos(c+.3*n.direction)*8,_+Math.sin(c+.3*n.direction)*8),t.fillStyle="rgba(255,255,255,0.4)",t.fill(),t.restore()}}function lt(t,n){const a=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16);return`rgb(${Math.round(a*(1-n))}, ${Math.round(o*(1-n))}, ${Math.round(i*(1-n))})`}function Rt(){if(!e(M))return;const t=e(M).getContext("2d");if(!t)return;const n=window.devicePixelRatio||1;t.setTransform(n,0,0,n,0,0),t.clearRect(0,0,e(T),e(D)),t.strokeStyle="rgba(255,255,255,0.04)",t.lineWidth=1;const a=40;for(let o=0;o<e(T);o+=a)t.beginPath(),t.moveTo(o,0),t.lineTo(o,e(D)),t.stroke();for(let o=0;o<e(D);o+=a)t.beginPath(),t.moveTo(0,o),t.lineTo(e(T),o),t.stroke();for(let o=0;o<e(f).length;o++)for(let i=o+1;i<e(f).length;i++)bt(e(f)[o],e(f)[i])&&(t.beginPath(),t.moveTo(e(f)[o].x,e(f)[o].y),t.lineTo(e(f)[i].x,e(f)[i].y),t.strokeStyle=e(f)[o].jammed?"rgba(255,0,0,0.3)":"rgba(255,255,255,0.15)",t.lineWidth=2,t.setLineDash([4,4]),t.stroke(),t.setLineDash([]));for(const o of e(f))_t(t,o,o.id===e(x));if(e(L)&&(e(u)||e(b))){const o=e(u)?e(u).teeth:e(b).teeth,i=e(u)?e(u).color:e(b).color,s=e(u)?e(u).type:e(b).type,l=e(u)?e(u).id:-1;let h=e(S),r=e(C);const c=st({teeth:o},h,r,l);c&&(h=c.x,r=c.y);const v={type:s,teeth:o,x:h,y:r,angle:0,rpm:0,direction:0,color:i,jammed:!1};t.globalAlpha=.5,_t(t,v,!1),t.globalAlpha=1,c&&(t.beginPath(),t.arc(h,r,w(o)+k+4,0,Math.PI*2),t.strokeStyle="#f1c40f",t.lineWidth=2,t.setLineDash([4,4]),t.stroke(),t.setLineDash([]))}}function yt(t){K||(K=t);const n=(t-K)/1e3;if(K=t,e(Y)){for(const a of e(f))if(a.direction!==0&&!a.jammed){const o=a.rpm/60;a.angle+=a.direction*o*Math.PI*2*n}}Rt(),at=requestAnimationFrame(yt)}function gt(t){if(!e(M))return{x:0,y:0};const n=e(M).getBoundingClientRect();return{x:(t.clientX-n.left)*(e(T)/n.width),y:(t.clientY-n.top)*(e(D)/n.height)}}function At(t,n){for(let a=e(f).length-1;a>=0;a--){const o=e(f)[a],i=w(o.teeth)+k,s=t-o.x,l=n-o.y;if(s*s+l*l<=i*i)return o}return null}function xt(t){var o;const n=gt(t),a=At(n.x,n.y);a?(t.preventDefault(),(o=e(M))==null||o.setPointerCapture(t.pointerId),d(L,!0),d(u,a,!0),d(b,null),O=n.x-a.x,z=n.y-a.y,d(S,n.x-O),d(C,n.y-z),d(x,a.id,!0)):d(x,null)}function Lt(t){if(!e(L))return;t.preventDefault();const n=gt(t);e(u)?(d(S,n.x-O),d(C,n.y-z)):e(b)&&(d(S,n.x,!0),d(C,n.y,!0))}function kt(t){if(e(L)){if(t.preventDefault(),e(u)){let n=e(S),a=e(C);const o=st({teeth:e(u).teeth},n,a,e(u).id);o&&(n=o.x,a=o.y),Mt(e(u).teeth,n,a,e(u).id)||(e(u).x=n,e(u).y=a),rt()}else if(e(b)){let n=e(S),a=e(C);const o=st({teeth:e(b).teeth},n,a,-1);o&&(n=o.x,a=o.y);const i=w(e(b).teeth);if(n>i&&n<e(T)-i&&a>i&&a<e(D)-i&&!Mt(e(b).teeth,n,a,-1)){const s={id:Ut(mt),type:e(b).type,teeth:e(b).teeth,x:n,y:a,angle:0,rpm:0,direction:0,color:e(b).color,jammed:!1,label:e(b).label};d(f,[...e(f),s],!0),d(x,s.id,!0),rt()}}d(L,!1),d(u,null),d(b,null)}}function Et(t,n){if(t.preventDefault(),d(L,!0),d(b,n,!0),d(u,null),e(M)){const a=e(M).getBoundingClientRect();d(S,(t.clientX-a.left)*(e(T)/a.width)),d(C,(t.clientY-a.top)*(e(D)/a.height))}O=0,z=0}function Gt(t){if(e(L)&&(t.preventDefault(),e(M))){const n=e(M).getBoundingClientRect(),a=(t.clientX-n.left)*(e(T)/n.width),o=(t.clientY-n.top)*(e(D)/n.height);e(u)?(d(S,a-O),d(C,o-z)):(d(S,a),d(C,o))}}function wt(){if(!e(Q))return;const t=e(Q).getBoundingClientRect();d(T,t.width,!0),d(D,Math.max(t.height,300),!0)}function ct(){if(!e(M))return;const t=window.devicePixelRatio||1;e(M).width=e(T)*t,e(M).height=e(D)*t}Ht(()=>{e(M)&&e(T)&&e(D)&&ct()}),ie(()=>{wt(),ct(),at=requestAnimationFrame(yt);const t=()=>{wt(),ct()};return window.addEventListener("resize",t),()=>{cancelAnimationFrame(at),window.removeEventListener("resize",t)}});var J=ve();te(t=>{Kt.title="Gear Train Simulator"}),J.__pointermove=Gt,J.__pointerup=[ae,L,kt];var dt=m(J),jt=y(m(dt),2),H=m(jt);H.__click=[le,Y];var Bt=m(H,!0);p(H);var ft=y(H,2);ft.__click=[se,x,f,rt];var Wt=y(ft,2);Wt.__click=[re,f,x,mt],p(jt),p(dt);var ht=y(dt,2);ee(ht,21,()=>Dt,ne,(t,n)=>{var a=de();a.__pointerdown=[ce,Et,n];var o=m(a);let i;var s=m(o);{var l=c=>{var v=U("‚ö°");R(c,v)};X(s,c=>{e(n).type==="motor"&&c(l)})}p(o);var h=y(o,2),r=m(h,!0);p(h),p(a),nt((c,v)=>{i=qt(o,"",i,{"background-color":e(n).color,width:`${c??""}px`,height:`${v??""}px`}),F(r,e(n).label)},[()=>Math.max(w(e(n).teeth)*.8,16),()=>Math.max(w(e(n).teeth)*.8,16)]),R(t,a)}),p(ht);var V=y(ht,2),N=m(V);N.__pointerdown=xt,N.__pointermove=Lt,N.__pointerup=kt;let Pt;Tt(N,t=>d(M,t),()=>e(M)),p(V),Tt(V,t=>d(Q,t),()=>e(Q));var $t=y(V,2);{var Ft=t=>{var n=he(),a=m(n),o=m(a,!0);p(a);var i=y(a,2),s=y(m(i),2),l=m(s,!0);p(s),p(i);var h=y(i,2),r=y(m(h),2),c=m(r,!0);p(r),p(h);var v=y(h,2),_=y(m(v),2),I=m(_);{var G=q=>{var B=U("Jammed");R(q,B)},Z=(q,B)=>{{var et=E=>{var ut=U("Clockwise ‚Üª");R(E,ut)},vt=(E,ut)=>{{var Yt=$=>{var pt=U("Counter-CW ‚Ü∫");R($,pt)},Ot=$=>{var pt=U("Idle");R($,pt)};X(E,$=>{e(P).direction===-1?$(Yt):$(Ot,!1)},ut)}};X(q,E=>{e(P).direction===1?E(et):E(vt,!1)},B)}};X(I,q=>{e(P).jammed?q(G):q(Z,!1)})}p(_),p(v);var tt=y(v,2);{var Xt=q=>{var B=fe(),et=y(m(B),2),vt=m(et);p(et),p(B),nt(E=>F(vt,`${E??""}x`),[()=>(e(P).rpm/W).toFixed(2)]),R(q,B)};X(tt,q=>{e(P).type!=="motor"&&e(P).rpm>0&&q(Xt)})}p(n),nt(q=>{F(o,e(P).type==="motor"?"Motor":`Gear (${e(P).teeth}T)`),F(l,e(P).teeth),F(c,q)},[()=>e(P).jammed?"JAMMED":Math.abs(e(P).rpm).toFixed(1)]),R(t,n)};X($t,t=>{e(P)&&t(Ft)})}Vt(4),p(J),nt(()=>{oe(H,"title",e(Y)?"Pause":"Play"),F(Bt,e(Y)?"‚è∏":"‚ñ∂Ô∏è"),ft.disabled=e(x)===null,Pt=qt(N,"",Pt,{width:`${e(T)??""}px`,height:`${e(D)??""}px`})}),R(A,J),Nt()}Zt(["pointermove","pointerup","click","pointerdown"]);export{we as component};
