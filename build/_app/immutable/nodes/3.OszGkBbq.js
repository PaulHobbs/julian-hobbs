import{t as D,a as m,c as ie,b as ce}from"../chunks/BJnBH3cn.js";import{h as He,y as ot,z as q,A as ve,B as I,C as ut,D as e,F as n,x as B,G as b,$ as it,I as p,J as Y,w as ct,v as fe}from"../chunks/q4hbtsPX.js";import{d as vt,h as ft,e as Ie,s as ee}from"../chunks/CLj1pCBc.js";import{i as G}from"../chunks/BxUkMfeN.js";import{t as dt,e as R,i as X,s as te}from"../chunks/C7K76AnF.js";import{b as pt}from"../chunks/CV-CDAN8.js";import{o as ht}from"../chunks/Bu-GM4GE.js";function de(h,w={},i,_){for(var P in i){var f=i[P];w[P]!==f&&(i[P]==null?h.style.removeProperty(P):h.style.setProperty(P,f,_))}}function z(h,w,i,_){var P=h.__style;if(He||P!==w){var f=dt(w,_);(!He||f!==h.getAttribute("style"))&&(f==null?h.removeAttribute("style"):h.style.cssText=f),h.__style=w}else _&&(Array.isArray(_)?(de(h,i==null?void 0:i[0],_[0]),de(h,i==null?void 0:i[1],_[1],"important")):de(h,i,_));return _}function gt(h,w,i,_,P,f,d,g,x){if(e(w)===null)return;h.preventDefault(),n(i,h.clientX,!0),n(_,h.clientY,!0),n(P,!0);const C=f(e(i),e(_)-60);C?(n(d,C.row,!0),n(g,C.col,!0),n(x,e(w),!0)):(n(d,null),n(g,null))}function _t(h,w,i,_,P,f,d,g,x,C,M,y){if(e(w)===null)return;h.preventDefault();const S=e(w);if(e(i)){const T=_(e(P),e(f)-60);if(T&&e(d)[S]){const O=e(d)[S];g(O,T.row,T.col)&&x(S,T.row,T.col)}}else C(S);n(w,null),n(i,!1),n(M,null),n(y,null)}var mt=D('<div class="combo-text svelte-1lvq3nx"> </div>'),bt=D("<button></button>"),xt=D("<div></div>"),qt=D('<div class="piece-grid svelte-1lvq3nx"></div>'),wt=D("<button><!></button>"),Pt=D("<div></div>"),St=D('<div class="drag-ghost svelte-1lvq3nx"><div class="piece-grid svelte-1lvq3nx"></div></div>'),Bt=D('<p class="new-best svelte-1lvq3nx">New Best!</p>'),Ct=D('<div class="game-over-overlay svelte-1lvq3nx"><div class="game-over-card svelte-1lvq3nx"><h2 class="svelte-1lvq3nx">Game Over!</h2> <p class="final-score svelte-1lvq3nx"> </p> <!> <button class="restart-btn svelte-1lvq3nx">Play Again</button></div></div>'),yt=D('<div class="game-container svelte-1lvq3nx"><div class="header svelte-1lvq3nx"><h1 class="svelte-1lvq3nx">Block Blast</h1> <div class="scores svelte-1lvq3nx"><div class="score-box svelte-1lvq3nx"><span class="score-label svelte-1lvq3nx">Score</span> <span class="score-value svelte-1lvq3nx"> </span></div> <div class="score-box high svelte-1lvq3nx"><span class="score-label svelte-1lvq3nx">Best</span> <span class="score-value svelte-1lvq3nx"> </span></div></div></div> <!> <div class="game-layout svelte-1lvq3nx"><div class="board svelte-1lvq3nx"></div> <div class="pieces-area svelte-1lvq3nx"><p class="pieces-label svelte-1lvq3nx"><!></p> <div class="pieces-row svelte-1lvq3nx"></div></div></div> <!> <!> <div class="back-link svelte-1lvq3nx"><a href="/" class="svelte-1lvq3nx">Back to Home</a></div></div>');function Mt(h,w){ot(w,!0);const i=8,_=["#e74c3c","#e67e22","#2ecc71","#3498db","#9b59b6","#f1c40f","#1abc9c"],P=[[[!0]],[[!0,!0]],[[!0,!0,!0]],[[!0,!0,!0,!0]],[[!0,!0,!0,!0,!0]],[[!0],[!0]],[[!0],[!0],[!0]],[[!0],[!0],[!0],[!0]],[[!0],[!0],[!0],[!0],[!0]],[[!0,!0],[!0,!0]],[[!0,!0,!0],[!0,!0,!0],[!0,!0,!0]],[[!0,!1],[!0,!1],[!0,!0]],[[!1,!0],[!1,!0],[!0,!0]],[[!0,!0],[!0,!1],[!0,!1]],[[!0,!0],[!1,!0],[!1,!0]],[[!0,!0,!0],[!1,!0,!1]],[[!1,!0,!1],[!0,!0,!0]],[[!0,!1],[!0,!0],[!0,!1]],[[!1,!0],[!0,!0],[!1,!0]],[[!0,!0,!1],[!1,!0,!0]],[[!1,!0,!0],[!0,!0,!1]],[[!0,!1],[!0,!0],[!1,!0]],[[!1,!0],[!0,!0],[!0,!1]],[[!0,!0],[!0,!1]],[[!0,!0],[!1,!0]],[[!0,!1],[!0,!0]],[[!1,!0],[!0,!0]]];let f=q(ve(pe())),d=q(ve([])),g=q(null),x=q(0),C=q(0),M=q(!1),y=q(null),S=q(null),T=q(ve(new Set)),O=q(""),re=null,$=q(null),j=q(0),K=q(0),k=q(!1),Q=q(void 0);function pe(){return Array.from({length:i},()=>Array(i).fill(null))}function Me(){return _[Math.floor(Math.random()*_.length)]}function le(){return{shape:P[Math.floor(Math.random()*P.length)],color:Me()}}function he(){n(d,[le(),le(),le()],!0),n(g,null)}function N(t,r,a){for(let l=0;l<t.shape.length;l++)for(let s=0;s<t.shape[l].length;s++)if(t.shape[l][s]){const c=r+l,o=a+s;if(c<0||c>=i||o<0||o>=i||e(f)[c][o]!==null)return!1}return!0}function Le(t){for(let r=0;r<i;r++)for(let a=0;a<i;a++)if(N(t,r,a))return!0;return!1}function ge(){for(const t of e(d))if(t&&Le(t))return!0;return!1}function Oe(t,r,a){let l=0;const s=e(f).map(c=>[...c]);for(let c=0;c<t.shape.length;c++)for(let o=0;o<t.shape[c].length;o++)t.shape[c][o]&&(s[r+c][a+o]=t.color,l++);n(f,s,!0),n(x,e(x)+l),_e()}function _e(){const t=[],r=[];for(let o=0;o<i;o++)e(f)[o].every(u=>u!==null)&&t.push(o);for(let o=0;o<i;o++){let u=!0;for(let v=0;v<i;v++)if(e(f)[v][o]===null){u=!1;break}u&&r.push(o)}const a=t.length+r.length;if(a===0)return;const l=new Set;for(const o of t)for(let u=0;u<i;u++)l.add(`${o},${u}`);for(const o of r)for(let u=0;u<i;u++)l.add(`${u},${o}`);const s=a*i,c=a>1?a*10:0;n(x,e(x)+(s+c)),a>1?me(`${a}x Combo! +${s+c}`):me(`Line clear! +${s}`),n(T,l,!0),setTimeout(()=>{const o=e(f).map(u=>[...u]);for(const u of l){const[v,A]=u.split(",").map(Number);o[v][A]=null}n(f,o,!0),n(T,new Set,!0),_e()},300)}function me(t){n(O,t,!0),re&&clearTimeout(re),re=setTimeout(()=>{n(O,"")},1500)}function Ee(t){e(M)||e(d)[t]!==null&&n(g,e(g)===t?null:t,!0)}function be(t,r,a){const l=e(d)[t];if(!l||!N(l,r,a))return;Oe(l,r,a);const s=[...e(d)];s[t]=null,n(d,s,!0),n(g,null),e(d).every(c=>c===null)?setTimeout(()=>{he(),ge()||qe()},350):ge()||setTimeout(()=>qe(),350)}function Fe(t,r){e(M)||e(g)===null||be(e(g),t,r)}function Ge(t,r){n(y,t,!0),n(S,r,!0)}function Re(){n(y,null),n(S,null)}function xe(t,r){if(!e(Q))return null;const a=e(Q).getBoundingClientRect(),l=6,s=t-a.left-l,c=r-a.top-l,o=(a.width-l*2)/i,u=Math.floor(s/o),v=Math.floor(c/o);return v<0||v>=i||u<0||u>=i?null:{row:v,col:u}}function Xe(t,r){e(M)||e(d)[r]===null||(t.preventDefault(),t.target.setPointerCapture(t.pointerId),n($,r,!0),n(j,t.clientX,!0),n(K,t.clientY,!0),n(k,!1))}function Ye(){return e($)===null||!e(k)?null:e(d)[e($)]??null}function ze(){const t=e(k)?e($):e(g);if(t===null||e(y)===null||e(S)===null)return new Set;const r=e(d)[t];if(!r)return new Set;if(!N(r,e(y),e(S)))return new Set;const a=new Set;for(let l=0;l<r.shape.length;l++)for(let s=0;s<r.shape[l].length;s++)r.shape[l][s]&&a.add(`${e(y)+l},${e(S)+s}`);return a}function Ne(){const t=e(k)?e($):e(g);if(t===null||e(y)===null||e(S)===null)return!1;const r=e(d)[t];return r?!N(r,e(y),e(S)):!1}function qe(){n(M,!0),e(x)>e(C)&&(n(C,e(x),!0),Je())}function we(){n(f,pe(),!0),n(x,0),n(M,!1),n(T,new Set,!0),n(O,""),n($,null),n(k,!1),he()}function Je(){try{localStorage.setItem("block-blast-high-score",String(e(C)))}catch{}}function Ue(){try{const t=localStorage.getItem("block-blast-high-score");t&&n(C,parseInt(t,10)||0,!0)}catch{}}let Ze=Y(ze),je=Y(Ne),V=Y(Ye);ht(()=>{Ue(),we()});function Ke(){const t=e(k)?e($):e(g);if(t===null)return"";const r=e(d)[t];return r?r.color:""}var J=yt();ft(t=>{it.title="Block Blast"}),J.__pointermove=[gt,$,j,K,k,xe,y,S,g],J.__pointerup=[_t,$,k,xe,j,K,d,N,be,Ee,y,S];var ne=b(J),Pe=B(b(ne),2),ae=b(Pe),Se=B(b(ae),2),Qe=b(Se,!0);p(Se),p(ae);var Be=B(ae,2),Ce=B(b(Be),2),Ve=b(Ce,!0);p(Ce),p(Be),p(Pe),p(ne);var ye=B(ne,2);{var We=t=>{var r=mt(),a=b(r,!0);p(r),I(()=>ee(a,e(O))),m(t,r)};G(ye,t=>{e(O)&&t(We)})}var se=B(ye,2),U=b(se);R(U,21,()=>e(f),X,(t,r,a)=>{var l=ie(),s=fe(l);R(s,17,()=>e(r),X,(c,o,u)=>{var v=bt();const A=Y(()=>`${a},${u}`),E=Y(()=>e(T).has(e(A))),H=Y(()=>e(Ze).has(e(A)));let L;v.__click=()=>Fe(a,u);let F;I((Z,W)=>{L=te(v,1,"cell svelte-1lvq3nx",null,L,Z),F=z(v,"",F,{"background-color":W,opacity:e(H)&&!e(o)?"0.5":"1"})},[()=>({filled:e(o)!==null,clearing:e(E),"hover-preview":e(H),"invalid-hover":e(je)&&(e(g)!==null||e($)!==null)&&e(y)!==null}),()=>e(E)?"#fff":e(H)?Ke():e(o)||""]),Ie("mouseenter",v,()=>Ge(a,u)),m(c,v)}),m(t,l)}),p(U),pt(U,t=>n(Q,t),()=>e(Q));var $e=B(U,2),oe=b($e),et=b(oe);{var tt=t=>{var r=ce("Drag onto the board");m(t,r)},rt=(t,r)=>{{var a=s=>{var c=ce("Tap the board to place");m(s,c)},l=s=>{var c=ce("Drag or tap a piece");m(s,c)};G(t,s=>{e(g)!==null?s(a):s(l,!1)},r)}};G(et,t=>{e(k)?t(tt):t(rt,!1)})}p(oe);var ke=B(oe,2);R(ke,21,()=>e(d),X,(t,r,a)=>{var l=wt();let s;l.__pointerdown=u=>Xe(u,a);var c=b(l);{var o=u=>{var v=qt();let A;R(v,21,()=>e(r).shape,X,(E,H)=>{var L=ie(),F=fe(L);R(F,17,()=>e(H),X,(Z,W)=>{var ue=xt();let Te,De;I(st=>{Te=te(ue,1,"piece-cell svelte-1lvq3nx",null,Te,st),De=z(ue,"",De,{"background-color":e(W)?e(r).color:"transparent"})},[()=>({"piece-filled":e(W)})]),m(Z,ue)}),m(E,L)}),p(v),I(()=>A=z(v,"",A,{"grid-template-columns":`repeat(${e(r).shape[0].length}, 1fr)`})),m(u,v)};G(c,u=>{e(r)&&u(o)})}p(l),I(u=>{s=te(l,1,"piece-container svelte-1lvq3nx",null,s,u),l.disabled=e(r)===null},[()=>({selected:e(g)===a&&!e(k),dragging:e($)===a&&e(k),used:e(r)===null})]),m(t,l)}),p(ke),p($e),p(se);var Ae=B(se,2);{var lt=t=>{var r=St();let a;var l=b(r);let s;R(l,21,()=>e(V).shape,X,(c,o)=>{var u=ie(),v=fe(u);R(v,17,()=>e(o),X,(A,E)=>{var H=Pt();let L,F;I(Z=>{L=te(H,1,"piece-cell drag-cell svelte-1lvq3nx",null,L,Z),F=z(H,"",F,{"background-color":e(E)?e(V).color:"transparent"})},[()=>({"piece-filled":e(E)})]),m(A,H)}),m(c,u)}),p(l),p(r),I(()=>{a=z(r,"",a,{left:`${e(j)??""}px`,top:`${e(K)-60}px`}),s=z(l,"",s,{"grid-template-columns":`repeat(${e(V).shape[0].length}, 1fr)`})}),m(t,r)};G(Ae,t=>{e(V)&&t(lt)})}var nt=B(Ae,2);{var at=t=>{var r=Ct(),a=b(r),l=B(b(a),2),s=b(l);p(l);var c=B(l,2);{var o=v=>{var A=Bt();m(v,A)};G(c,v=>{e(x)>=e(C)&&e(x)>0&&v(o)})}var u=B(c,2);u.__click=we,p(a),p(r),I(()=>ee(s,`Score: ${e(x)??""}`)),m(t,r)};G(nt,t=>{e(M)&&t(at)})}ct(2),p(J),I(()=>{ee(Qe,e(x)),ee(Ve,e(C))}),Ie("mouseleave",U,Re),m(h,J),ut()}vt(["pointermove","pointerup","click","pointerdown"]);export{Mt as component};
